<?xml version="1.0" encoding="UTF-8"?>
<testcase>
	<brief>1 Portal, 2 hops MP, Client associate /disassociate ,make sure client's route can be update</brief>
	<priority>Accept</priority>
	<automated>yes</automated>
	<description>
		Pre-Condition:

		-configure three APs in the same subnet and same hive
		-MP 1 and MP 2 are mesh point
		-Create a SSID on wifi0 and client associate , pass authentication

		Test Procedure:

		1. Client associate to MP2 ,show route, check route table in Portal1.
		2. Show route, check route table in MP1
		3. Show route, check route table in MP2
		4. Client send unicast(ICMP packets), broadcast pkt.(debug FE)
		5. Client associate to MP2,check route table---check time how longer add
		6. Client disassociate to MP2
		7. Clients associate to MP1 MP2 and Portal1,check route table, running traffic.
		8. When client associate to MP2,check route table, data traffic.
		c. Client ping wired pc
		d. Client ping ap1,ap2,ap3
	</description>
	<numofap>3</numofap>
	<numofsta>3</numofsta>
	<tbtype>linux</tbtype>

	<property name="conn1.ssid" value="${ssid.name}_1" />
	<property name="conn2.ssid" value="${ssid.name}_2" />
	<property name="conn3.ssid" value="${ssid.name}_3" />

	<stage>
		<step no="1.1.0">
			<desc>
				-if eth1 exist,shutdown eth1
			</desc>
			<if>"${ap1.eth1.existed}" == "true"</if>
			<console target="ap1">
				-v "interface eth1 shutdown"
			</console>
		</step>
		
		<step no="1.1">
			<desc>
				-configure mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<console target="ap1">
				-v "hive ${hive.name}"
				-v "interface mgt0 hive ${hive.name}"
				-v "interface wifi0 radio channel 6"
				-v "interface wifi1 radio channel 36"
				-v "ssid ${conn1.ssid}"
				-v "interface wifi0 ssid ${conn1.ssid}"
				-v "interface eth0 shutdown"
				-v "save config"
			</console>
		</step>
		
		<step no="1.1_0">
			<desc>
				-configure mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<console target="ap1">
				-v "hive ${hive.name}"
				-v "interface mgt0 hive ${hive.name}"
				-v "interface wifi0 radio channel 6"	
				-v "interface wifi0 mode dual"			
				-v "ssid ${conn1.ssid}"
				-v "interface wifi0 ssid ${conn1.ssid}"
				-v "interface eth0 shutdown"
				-v "save config"
			</console>
		</step>
		
		<step no="1.2.0">
			<desc>
				-if eth1 exist,shutdown eth1
			</desc>
			<if>"${ap1.eth1.existed}" == "true"</if>
			<console target="ap2">
				-v "interface eth1 shutdown"
			</console>
		</step>

		<step no="1.2">
			<desc>
				-configure mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<console target="ap2">
				-v "hive ${hive.name}"
				-v "interface mgt0 hive ${hive.name}"
				-v "interface wifi0 radio channel 6"
				-v "interface wifi1 radio channel 36"
				-v "ssid ${conn2.ssid}"
				-v "interface wifi0 ssid ${conn2.ssid}"
				-v "interface eth0 shutdown"
				-v "save config"
			</console>
		</step>
		
		<step no="1.2_0">
			<desc>
				-configure mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<console target="ap2">
				-v "hive ${hive.name}"
				-v "interface mgt0 hive ${hive.name}"
				-v "interface wifi0 radio channel 6"
				-v "interface wifi0 mode dual"
				-v "ssid ${conn2.ssid}"
				-v "interface wifi0 ssid ${conn2.ssid}"
				-v "interface eth0 shutdown"
				-v "save config"
			</console>
		</step>
		
		<step no="1.3.0">
			<desc>
				-if eth1 exist,shutdown eth1
			</desc>
			<if>"${ap1.eth1.existed}" == "true"</if>
			<console target="ap3">
				-v "interface eth1 shutdown"
			</console>
		</step>
		
		<step no="1.3">
			<desc>
				-configure Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<console target="ap3">
				-v "hive ${hive.name}"
				-v "interface mgt0 hive ${hive.name}"
				-v "interface wifi0 radio channel 6"
				-v "interface wifi1 radio channel 36"
				-v "ssid ${conn3.ssid}"
				-v "interface wifi0 ssid ${conn3.ssid}"
				-v "security mac-filter aaa default permit"
				-v "hive ${hive.name} security mac-filter aaa"
				-v "save config"
			</console>
		</step>
		
		<step no="1.3_0">
			<desc>
				-configure Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<console target="ap3">
				-v "hive ${hive.name}"
				-v "interface mgt0 hive ${hive.name}"
				-v "interface wifi0 radio channel 6"
				-v "interface wifi0 mode dual"
				-v "ssid ${conn3.ssid}"
				-v "interface wifi0 ssid ${conn3.ssid}"
				-v "security mac-filter aaa default permit"
				-v "hive ${hive.name} security mac-filter aaa"
				-v "save config"
			</console>
		</step>

		<step no="2.1">
			<desc>
				-reboot Portal1
			</desc>
			<console target="ap3">
				-v "reboot"
			</console>
		</step>

		<step no="2.2" delay="15">
			<desc>
				-reboot mp1
			</desc>
			<console target="ap1">
				-v "reboot"
			</console>
		</step>

		<step no="2.3" delay="15">
			<desc>
				-reboot mp2
			</desc>
			<console target="ap2">
				-v "reboot"
			</console>
		</step>
		
		<step no="1.1.1" delay="90">
			<desc>
				-show interface in mp1
			</desc>
			<log-file>step1.1.1_show_interface_ap1.log</log-file>
			<console target="ap1">
				-v "show interface"
			</console>
		</step>

		<step no="1.1.2">
			<desc>
				Get mgt0 mac in mp1
			</desc>
			<setvar name="mp1.mgt0.mac">
				${bin.dir}/getbyrexp.py -p "Mgt0 *(\S+) *" -f ${log.dir}/step1.1.1_show_interface_ap1.log -t str
			</setvar>
		</step>

		<step no="1.1.3">
			<desc>
				Get wifi1 mac in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<setvar name="mp1.wifi1.mac">
				${bin.dir}/getbyrexp.py -p "Wifi1.1 *(\S+) *" -f ${log.dir}/step1.1.1_show_interface_ap1.log -t str
			</setvar>
		</step>
		
		<step no="1.1.3_0">
			<desc>
				Get wifi1 mac in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<setvar name="mp1.wifi1.mac">
				${bin.dir}/getbyrexp.py -p "Wifi0.1 *(\S+) *" -f ${log.dir}/step1.1.1_show_interface_ap1.log -t str
			</setvar>
		</step>		
		
		<step no="1.2.1">
			<desc>
				-show interface in mp2
			</desc>
			<log-file>step1.2.1_show_interface_ap2.log</log-file>
			<console target="ap2">
				-v "show interface"
			</console>
		</step>

		<step no="1.2.2">
			<desc>
				Get mgt0 mac in mp2
			</desc>
			<setvar name="mp2.mgt0.mac">
				${bin.dir}/getbyrexp.py -p "Mgt0 *(\S+) *" -f ${log.dir}/step1.2.1_show_interface_ap2.log -t str
			</setvar>
		</step>

		<step no="1.2.3">
			<desc>
				Get wifi1 mac in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<setvar name="mp2.wifi1.mac">
				${bin.dir}/getbyrexp.py -p "Wifi1.1 *(\S+) *" -f ${log.dir}/step1.2.1_show_interface_ap2.log -t str
			</setvar>
		</step>
		
		<step no="1.2.3_0">
			<desc>
				Get wifi1 mac in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<setvar name="mp2.wifi1.mac">
				${bin.dir}/getbyrexp.py -p "Wifi0.1 *(\S+) *" -f ${log.dir}/step1.2.1_show_interface_ap2.log -t str
			</setvar>
		</step>

		<step no="1.3.1">
			<desc>
				-show interface in Portal1
			</desc>
			<log-file>step1.3.1_show_interface_ap3.log</log-file>
			<console target="ap3">
				-v "show interface"
			</console>
		</step>
		
		<step no="1.3.2">
			<desc>
				Get mgt0 mac in Portal1
			</desc>
			<setvar name="por1.mgt0.mac">
				${bin.dir}/getbyrexp.py -p "Mgt0 *(\S+) *" -f ${log.dir}/step1.3.1_show_interface_ap3.log -t str
			</setvar>
		</step>
		
		<step no="1.3.3">
			<desc>
				Get wifi1 mac in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<setvar name="por1.wifi1.mac">
				${bin.dir}/getbyrexp.py -p "Wifi1.1 *(\S+) *" -f ${log.dir}/step1.3.1_show_interface_ap3.log -t str
			</setvar>
		</step>
		
		<step no="1.3.3_0">
			<desc>
				Get wifi1 mac in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<setvar name="por1.wifi1.mac">
				${bin.dir}/getbyrexp.py -p "Wifi0.1 *(\S+) *" -f ${log.dir}/step1.3.1_show_interface_ap3.log -t str
			</setvar>
		</step>
		
		<step no="1.3.3.0">
			<desc>
				-show interface in Portal1
			</desc>
			<log-file>step1.3.1_show_interface_ap3.log</log-file>
			<console target="ap3">
				-v "security mac-filter aaa address ${mp2.wifi1.mac} deny"
			</console>
		</step>

		<step no="3" delay="90">
			<desc>
				-ifconfig wlan0 in sta1
			</desc>
			<log-file>step3_ifconfig_wlan0.log</log-file>
			<ssh target="sta1">
				-v "ifconfig ${sta1.tif.name}"
			</ssh>
		</step>

		<step no="3.1">
			<desc>
				Get sta1 mac
			</desc>
			<setvar name="sta1.mac">
				perl ${bin.dir}/getrmtip.pl -f ${log.dir}/step3_ifconfig_wlan0.log -i ${sta1.tif.name} -m -width
			</setvar>
		</step>

		<step no="3.2">
			<desc>
				-ifconfig wlan0 in sta2
			</desc>
			<log-file>step3.2_ifconfig_wlan0.log</log-file>
			<ssh target="sta2">
				-v "ifconfig ${sta2.tif.name}"
			</ssh>
		</step>

		<step no="3.3">
			<desc>
				Get sta2 mac
			</desc>
			<setvar name="sta2.mac">
				perl ${bin.dir}/getrmtip.pl -f ${log.dir}/step3.2_ifconfig_wlan0.log -i ${sta2.tif.name} -m -width
			</setvar>
		</step>

		<step no="3.4">
			<desc>
				-ifconfig wlan0 in sta3
			</desc>
			<log-file>step3.4_ifconfig_wlan0.log</log-file>
			<ssh target="sta3">
				-v "ifconfig ${sta3.tif.name}"
			</ssh>
		</step>

		<step no="3.5">
			<desc>
				Get sta3 mac
			</desc>
			<setvar name="sta3.mac">
				perl ${bin.dir}/getrmtip.pl -f ${log.dir}/step3.4_ifconfig_wlan0.log -i ${sta3.tif.name} -m -width
			</setvar>
		</step>

		<include prefix="4.0" file="subs/get_ap_ip_mac.xml" rargs="ap2" />
		
		<include prefix="4" file="subs/sta_wifi_connect_${tb.os}.xml" rargs="conn2, sta2, ap2" />

		<step no="4.1">
			<desc>
				-show route in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step4.1_show_route.log</log-file>
			<console target="ap2">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta2.mac} *${mp2.mgt0.mac} *wifi0.1"</log-match>
		</step>
		
		<step no="4.1_0">
			<desc>
				-show route in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step4.1_show_route.log</log-file>
			<console target="ap2">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta2.mac} *${mp2.mgt0.mac} *wifi0.2"</log-match>
		</step>

		<step no="4.2">
			<desc>
				-show route in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step4.2_show_route.log</log-file>
			<console target="ap1">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta2.mac} *${mp2.wifi1.mac} *wifi1.1"</log-match>
		</step>
		
		<step no="4.2_0">
			<desc>
				-show route in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step4.2_show_route.log</log-file>
			<console target="ap1">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta2.mac} *${mp2.wifi1.mac} *wifi0.1"</log-match>
		</step>

		<step no="4.3">
			<desc>
				-show route in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step4.3_show_route.log</log-file>
			<console target="ap3">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta2.mac} *${mp1.wifi1.mac} *wifi1.1"</log-match>
		</step>
		
		<step no="4.3_0">
			<desc>
				-show route in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step4.3_show_route.log</log-file>
			<console target="ap3">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta2.mac} *${mp1.wifi1.mac} *wifi0.1"</log-match>
		</step>

		<step no="5.0.1">
			<desc>
				open debug on mp2
			</desc>
			<console target="ap2">
				-v "show station"
				-v "_kdebug fe basic"
				-v "_kdebug fe detail"
				-v "_ff protocol 1"
				-v "clear log all"
			</console>
		</step>

		<step no="5.0.2">
			<desc>
				open debug on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "_kdebug fe basic"
				-v "_kdebug fe detail"
				-v "_ff protocol 1"
				-v "clear log all"
			</console>
		</step>

		<step no="5.0.3">
			<desc>
				open debug on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "_kdebug fe basic"
				-v "_kdebug fe detail"
				-v "_ff protocol 1"
				-v "clear log all"
			</console>
		</step>

		<include prefix="5.1" file="subs/sta_ping.xml" args="sta2, ${mpc.tif.ip}, 4" />

		<include prefix="5.1.0" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step5.1.0_show_logging_buffered.log" />

		<step no="5.1.1">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.1.1_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta2.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi1.1 ${mpc.tif.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${mpc.tif.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="5.1.1_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.1.1_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta2.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta2.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi0.1 ${mpc.tif.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.2 ${mpc.tif.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="5.1.2">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.1.2_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta2.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta2.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi1.1 ${mpc.tif.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi1.1 ${mpc.tif.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="5.1.2_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.1.2_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta2.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi0.1 ${mpc.tif.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${mpc.tif.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="5.1.3">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.1.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta2.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) eth0 ${sta2.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) eth0 ${mpc.tif.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi1.1 ${mpc.tif.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="5.1.3_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.1.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) eth0 ${sta2.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) eth0 ${mpc.tif.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${mpc.tif.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="5.2.1">
			<desc>
				clear log all on mp2
			</desc>
			<console target="ap2">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="5.2.2">
			<desc>
				clear log all on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="5.2.3">
			<desc>
				clear log all on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<include prefix="5.2.4" file="subs/sta_ping.xml" args="sta2, ${ap1.mgt0.ip}, 4" />

		<include prefix="5.2.4.0" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step5.2.4.0_show_logging_buffered.log" />

		<step no="5.2.5">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.2.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta2.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi1.1 ${ap1.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="5.2.5_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.2.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta2.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta2.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.2 ${ap1.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="5.2.6">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.2.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta2.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta2.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${ap1.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi1.1 ${ap1.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="5.2.6_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.2.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta2.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="5.2.7">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.2.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-n -i "(i) wifi1.1 ${sta2.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${sta2.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${ap1.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${ap1.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="5.2.7_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.2.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-n -i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${sta2.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${ap1.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="5.3.1">
			<desc>
				clear log all on mp2
			</desc>
			<console target="ap2">
			    -v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="5.3.2">
			<desc>
				clear log all on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="5.3.3">
			<desc>
				clear log all on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<include prefix="5.3.4_0" file="subs/get_ap_ip_mac.xml" rargs="ap2" />
		
		<include prefix="5.3.4" file="subs/sta_ping.xml" args="sta2, ${ap2.mgt0.ip}, 4" />

		<include prefix="5.3.4.0" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step5.3.4.0_show_logging_buffered.log" />

		<step no="5.3.5">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.3.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta2.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${ap2.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="5.3.5_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.3.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta2.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta2.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.2 ${ap2.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="5.3.6">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.3.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi1.1 ${sta2.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta2.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${ap2.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${ap2.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="5.3.6_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.3.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta2.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="5.3.7">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.3.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-n -i "(i) wifi1.1 ${sta2.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${sta2.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${ap2.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${ap2.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="5.3.7_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.3.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-n -i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${sta2.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${ap2.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="5.4.1">
			<desc>
				clear log all on mp2
			</desc>
			<console target="ap2">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="5.4.2">
			<desc>
				clear log all on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="5.4.3">
			<desc>
				clear log all on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<include prefix="5.4.4_0" file="subs/get_ap_ip_mac.xml" rargs="ap3" />
		
		<include prefix="5.4.4" file="subs/sta_ping.xml" args="sta2, ${ap3.mgt0.ip}, 4" />

		<include prefix="5.4.5" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step5.4.5_show_logging_buffered.log" />

		<step no="5.4.6">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.4.6_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta2.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi1.1 ${ap3.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="5.4.6_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.4.6_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta2.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta2.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.2 ${ap3.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="5.4.7">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.4.7_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta2.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta2.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi1.1 ${ap3.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi1.1 ${ap3.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="5.4.7_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.4.7_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta2.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="5.4.8">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.4.5_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta2.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${sta2.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${ap3.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi1.1 ${ap3.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="5.4.8_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.4.5_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${sta2.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${ap3.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta2.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="5.5.1">
			<desc>
				clear log all on mp2
			</desc>
			<console target="ap2">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="5.5.2">
			<desc>
				clear log all on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="5.5.3">
			<desc>
				clear log all on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="5.6">
			<desc>
				sta2 send broadcast packet
			</desc>
			<log-file>step5.6_sta2_send_broadcast.log</log-file>
			<ssh target="sta2">
				-v "ping ${tb.vlan1.broadcast} -b -c 5"
			</ssh>
			<no-error-check />
			<log-match>-c -i "from ${ap2.mgt0.gw}: " -i "ttl="</log-match>
		</step>

		<include prefix="5.6.1" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step5.6.1_show_logging_buffered.log" />

		<step no="5.6.2">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.6.2_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi1.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "wifi1.1 drop illegal broadcast from ${mp1.wifi1.mac}" -i "route-nhop ${mp2.wifi0.mac}"</log-match>
			<log-match>-i "interface down, don't flood on eth0"</log-match>
		</step>
		
		<step no="5.6.2_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.6.2_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.2 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "wifi0.1 drop illegal broadcast from ${mp1.wifi1.mac}" -i "route-nhop ${mp2.wifi0.mac}"</log-match>
			<log-match>-i "interface down, don't flood on eth0"</log-match>
		</step>

		<step no="5.6.3">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.6.3_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi1.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "wifi1.1 drop illegal broadcast from ${por1.wifi1.mac}" -i "route-nhop ${mp2.wifi1.mac}"</log-match>
			<log-match>-i "interface down, don't flood on eth0"</log-match>
		</step>
		
		<step no="5.6.3_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.6.3_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.2 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "interface down, don't flood on eth0"</log-match>
		</step>

		<step no="5.6.4">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step5.6.1_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) eth0 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
		</step>
		
		<step no="5.6.4_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step5.6.1_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) eth0 ${sta2.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
		</step>

		<step no="5.7" delay="10">
			<desc>Disconnect the link of sta2 and ap2</desc>
			<ssh target="sta2" prompt=">|.*#">
				-v "wpa_cli"
				-v "disc"
				-v "ter"
				-v "quit"
			</ssh>
		</step>

		<step no="6.1">
			<desc>
				-show route in mp2
			</desc>
			<log-file>step6.1_show_route.log</log-file>
			<console target="ap2">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-n -c -i "${sta2.mac} *${mp2.mgt0.mac} *wifi0.1"</log-match>
		</step>

		<step no="6.2">
			<desc>
				-show route in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step6.2_show_route.log</log-file>
			<console target="ap1">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-n -c -i "${sta2.mac} *${mp2.wifi1.mac} *wifi1.1"</log-match>
		</step>
		
		<step no="6.2_0">
			<desc>
				-show route in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step6.2_show_route.log</log-file>
			<console target="ap1">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-n -c -i "${sta2.mac} *${mp2.wifi1.mac} *wifi0.1"</log-match>
		</step>

		<step no="6.3">
			<desc>
				-show route in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step6.3_show_route.log</log-file>
			<console target="ap3">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-n -c -i "${sta2.mac} *${mp1.wifi1.mac} *wifi1.1"</log-match>
		</step>
		
		<step no="6.3_0">
			<desc>
				-show route in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step6.3_show_route.log</log-file>
			<console target="ap3">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-n -c -i "${sta2.mac} *${mp1.wifi1.mac} *wifi0.1"</log-match>
		</step>

		<include prefix="7.0" file="subs/get_ap_ip_mac.xml" rargs="ap1" />
		
		<include prefix="7" file="subs/sta_wifi_connect_${tb.os}.xml" rargs="conn1, sta1, ap1" />

		<step no="7.1">
			<desc>
				-show route in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.1_show_route.log</log-file>
			<console target="ap2">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta1.mac} *${mp1.wifi1.mac} *wifi1.1"</log-match>
		</step>
		
		<step no="7.1_0">
			<desc>
				-show route in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.1_show_route.log</log-file>
			<console target="ap2">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta1.mac} *${mp1.wifi1.mac} *wifi0.1"</log-match>
		</step>

		<step no="7.2">
			<desc>
				-show route in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.2_show_route.log</log-file>
			<console target="ap1">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta1.mac} *${mp1.mgt0.mac} *wifi0.1"</log-match>
		</step>
		
		<step no="7.2_0">
			<desc>
				-show route in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.2_show_route.log</log-file>
			<console target="ap1">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta1.mac} *${mp1.mgt0.mac} *wifi0.2"</log-match>
		</step>

		<step no="7.3">
			<desc>
				-show route in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.3_show_route.log</log-file>
			<console target="ap3">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta1.mac} *${mp1.wifi1.mac} *wifi1.1"</log-match>
		</step>
		
		<step no="7.3_0">
			<desc>
				-show route in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.3_show_route.log</log-file>
			<console target="ap3">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta1.mac} *${mp1.wifi1.mac} *wifi0.1"</log-match>
		</step>

		<step no="7.4.1">
			<desc>
				clear log all on mp2
			</desc>
			<console target="ap2">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="7.4.2">
			<desc>
				clear log all on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="7.4.3">
			<desc>
				clear log all on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<include prefix="7.4.4" file="subs/sta_ping.xml" args="sta1, ${mpc.tif.ip}, 4" />

		<include prefix="7.4.5" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step7.4.5_show_logging_buffered.log" />

		<step no="7.4.6">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.4.5_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta1.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) eth0 ${sta1.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) eth0 ${mpc.tif.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi1.1 ${mpc.tif.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="7.4.6_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.4.5_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) eth0 ${sta1.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) eth0 ${mpc.tif.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${mpc.tif.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="7.4.7">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.4.7_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi1.1 ${sta1.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta1.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${mpc.tif.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${mpc.tif.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="7.4.7_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.4.7_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta1.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${mpc.tif.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${mpc.tif.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="7.4.8">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.4.8_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta1.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi1.1 ${mpc.tif.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${mpc.tif.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="7.4.8_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.4.8_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta1.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta1.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi0.1 ${mpc.tif.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.2 ${mpc.tif.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="7.5.1">
			<desc>
				clear log all on mp2
			</desc>
			<console target="ap2">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="7.5.2">
			<desc>
				clear log all on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="7.5.3">
			<desc>
				clear log all on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<include prefix="7.5.4" file="subs/sta_ping.xml" args="sta1, ${ap1.mgt0.ip}, 4" />

		<include prefix="7.5.4.0" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step7.5.4.0_show_logging_buffered.log" />

		<step no="7.5.5">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.5.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi1.1 ${sta1.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta1.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${ap1.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${ap1.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="7.5.5_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.5.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta1.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="7.5.6">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.5.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta1.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${ap1.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="7.5.6_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.5.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta1.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta1.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.2 ${ap1.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="7.5.7">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.5.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-n -i "(i) wifi1.1 ${sta1.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${sta1.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${ap1.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${ap1.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="7.5.7_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.5.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-n -i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${sta1.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${ap1.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="7.6.1">
			<desc>
				clear log all on mp2
			</desc>
			<console target="ap2">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="7.6.2">
			<desc>
				clear log all on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="7.6.3">
			<desc>
				clear log all on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<include prefix="7.6.4" file="subs/sta_ping.xml" args="sta1, ${ap2.mgt0.ip}, 4" />

		<include prefix="7.6.4.0" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step7.6.4.0_show_logging_buffered.log" />

		<step no="7.6.5">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.6.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta1.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta1.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${ap2.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi1.1 ${ap2.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="7.6.5_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.6.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta1.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="7.6.6">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.6.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta1.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi1.1 ${ap2.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="7.6.6_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.6.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta1.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta1.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.2 ${ap2.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="7.6.7">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.6.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-n -i "(i) wifi1.1 ${sta1.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${sta1.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${ap2.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${ap2.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="7.6.7_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.6.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-n -i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${sta1.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${ap2.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="7.7.1">
			<desc>
				clear log all on mp2
			</desc>
			<console target="ap2">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="7.7.2">
			<desc>
				clear log all on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="7.7.3">
			<desc>
				clear log all on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<include prefix="7.7.4" file="subs/sta_ping.xml" args="sta1, ${ap3.mgt0.ip}, 4" />

		<include prefix="7.7.4.0" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step7.7.4.0_show_logging_buffered.log" />

		<step no="7.7.5">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.7.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi1.1 ${sta1.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta1.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${ap3.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${ap3.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="7.7.5_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.7.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta1.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="7.7.6">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.7.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta1.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi1.1 ${ap3.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="7.7.6_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.7.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta1.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta1.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.2 ${ap3.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="7.7.7">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.7.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta1.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${sta1.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${ap3.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi1.1 ${ap3.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="7.7.7_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.7.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${sta1.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${ap3.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta1.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="7.8.1">
			<desc>
				clear log all on mp2
			</desc>
			<console target="ap2">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="7.8.2">
			<desc>
				clear log all on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="7.8.3">
			<desc>
				clear log all on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="7.9">
			<desc>
				sta1 send broadcast packet
			</desc>
			<log-file>step7.9_sta2_send_broadcast.log</log-file>
			<ssh target="sta1">
				-v "ping ${tb.vlan1.broadcast} -b -c 5"
			</ssh>
			<no-error-check />
			<log-match>-c -i "from ${ap1.mgt0.gw}: " -i "ttl="</log-match>
		</step>

		<include prefix="7.9.0" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step7.9.0_show_logging_buffered.log" />

		<step no="7.9.1">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.9.1_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "interface down, don't flood on eth0"</log-match>
		</step>
		
		<step no="7.9.1_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.9.1_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "interface down, don't flood on eth0"</log-match>
		</step>

		<step no="7.9.2">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.9.2_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi1.1 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "wifi1.1 drop illegal broadcast from ${por1.wifi1.mac}" -i "route-nhop ${mp1.mgt0.mac}"</log-match>
			<log-match>-i "wifi1.1 drop illegal broadcast from ${mp2.wifi1.mac}" -i "route-nhop ${mp1.mgt0.mac}"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "interface down, don't flood on eth0"</log-match>
		</step>
		
		<step no="7.9.2_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.9.2_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.2 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "interface down, don't flood on eth0"</log-match>
		</step>

		<step no="7.9.3">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step7.9.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) eth0 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
		</step>
		
		<step no="7.9.3_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step7.9.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) eth0 ${sta1.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
		</step>

		<step no="7.10" delay="10">
			<desc>Disconnect the link of sta1 and ap1</desc>
			<ssh target="sta1" prompt=">|.*#">
				-v "wpa_cli"
				-v "disc"
				-v "ter"
				-v "quit"
			</ssh>
		</step>

		<step no="7.11">
			<desc>packet_size init to 64</desc>
			<setvar name="packet_size">
				if [ "${tb.os}" == "linux" ]; then
				echo 56
				else
				echo 56 ## should be 64. now temp set to 64
				fi
			</setvar>
		</step>

		<include prefix="8.0" file="subs/get_ap_ip_mac.xml" rargs="ap3" />
		
		<include prefix="8" file="subs/sta_wifi_connect_${tb.os}.xml" rargs="conn3, sta3, ap3" />

		<step no="8.1">
			<desc>
				-show route in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.1_show_route.log</log-file>
			<console target="ap2">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta3.mac} *${mp1.wifi1.mac} *wifi1.1"</log-match>
		</step>
		
		<step no="8.1_0">
			<desc>
				-show route in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.1_show_route.log</log-file>
			<console target="ap2">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta3.mac} *${mp1.wifi1.mac} *wifi0.1"</log-match>
		</step>

		<step no="8.2">
			<desc>
				-show route in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.2_show_route.log</log-file>
			<console target="ap1">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta3.mac} *${por1.wifi1.mac} *wifi1.1"</log-match>
		</step>
		
		<step no="8.2_0">
			<desc>
				-show route in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.2_show_route.log</log-file>
			<console target="ap1">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta3.mac} *${por1.wifi1.mac} *wifi0.1"</log-match>
		</step>

		<step no="8.3">
			<desc>
				-show route in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.3_show_route.log</log-file>
			<console target="ap3">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta3.mac} *${por1.mgt0.mac} *wifi0.1"</log-match>
		</step>
		
		<step no="8.3_0">
			<desc>
				-show route in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.3_show_route.log</log-file>
			<console target="ap3">
				-v "show route"
			</console>
			<no-error-check />
			<log-match>-c -i "${sta3.mac} *${por1.mgt0.mac} *wifi0.2"</log-match>
		</step>

		<step no="8.4.1">
			<desc>
				clear log all on mp2
			</desc>
			<console target="ap2">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="8.4.2">
			<desc>
				clear log all on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="8.4.3">
			<desc>
				clear log all on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<include prefix="8.4.4" file="subs/sta_ping.xml" args="sta3, ${mpc.tif.ip}, 4" />

		<include prefix="8.4.4.0" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step8.4.4.0_show_logging_buffered.log" />

		<step no="8.4.5">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.4.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi1.1 ${sta3.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta3.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${mpc.tif.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${mpc.tif.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="8.4.5_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.4.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta3.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${mpc.tif.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${mpc.tif.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="8.4.6">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.4.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi1.1 ${sta3.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta3.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${mpc.tif.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${mpc.tif.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="8.4.6_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.4.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta3.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${mpc.tif.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${mpc.tif.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="8.4.7">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.4.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) eth0 ${sta3.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) eth0 ${mpc.tif.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${mpc.tif.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="8.4.7_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.4.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta3.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) eth0 ${sta3.tif.ip}-&gt;${mpc.tif.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) eth0 ${mpc.tif.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.2 ${mpc.tif.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="8.5.1">
			<desc>
				clear log all on mp2
			</desc>
			<console target="ap2">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="8.5.2">
			<desc>
				clear log all on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="8.5.3">
			<desc>
				clear log all on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<include prefix="8.5.4" file="subs/sta_ping.xml" args="sta3, ${ap1.mgt0.ip}, 4" />

		<include prefix="8.5.4.0" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step8.5.4.0_show_logging_buffered.log" />

		<step no="8.5.5">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.5.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi1.1 ${sta3.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta3.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${ap1.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${ap1.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="8.5.5_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.5.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta3.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="8.5.6">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.5.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta3.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta3.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${ap1.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi1.1 ${ap1.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="8.5.6_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.5.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta3.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="8.5.7">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.5.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta3.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${sta3.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${ap1.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(i) wifi1.1 ${ap1.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="8.5.7_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.5.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta3.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta3.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${sta3.tif.ip}-&gt;${ap1.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${ap1.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(i) wifi0.1 ${ap1.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.2 ${ap1.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="8.6.1">
			<desc>
				clear log all on mp2
			</desc>
			<console target="ap2">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="8.6.2">
			<desc>
				clear log all on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="8.6.3">
			<desc>
				clear log all on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<include prefix="8.6.4" file="subs/sta_ping.xml" args="sta3, ${ap2.mgt0.ip}, 4" />

		<include prefix="8.6.4.0" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step8.6.4.0_show_logging_buffered.log" />

		<step no="8.6.5">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.6.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta3.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta3.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${ap2.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi1.1 ${ap2.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="8.6.5_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.6.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta3.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="8.6.6">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.6.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta3.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta3.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi1.1 ${ap2.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi1.1 ${ap2.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="8.6.6_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.6.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta3.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(i) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="8.6.7">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.6.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta3.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${sta3.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${ap2.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(i) wifi1.1 ${ap2.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="8.6.7_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.6.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta3.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta3.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${sta3.tif.ip}-&gt;${ap2.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${ap2.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(i) wifi0.1 ${ap2.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.2 ${ap2.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="8.7.1">
			<desc>
				clear log all on mp2
			</desc>
			<console target="ap2">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="8.7.2">
			<desc>
				clear log all on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="8.7.3">
			<desc>
				clear log all on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<include prefix="8.7.4" file="subs/sta_ping.xml" args="sta3, ${ap3.mgt0.ip}, 4" />

		<include prefix="8.7.4.0" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step8.7.4.0_show_logging_buffered.log" />

		<step no="8.7.5">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.7.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi1.1 ${sta3.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta3.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${ap3.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${ap3.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="8.7.5_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.7.5_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta3.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="8.7.6">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.7.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi1.1 ${sta3.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta3.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${ap3.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${ap3.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="8.7.6_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.7.6_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-n -i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta3.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="8.7.7">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step8.7.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi1.1 ${sta3.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${sta3.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${ap3.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(i) wifi1.1 ${ap3.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>
		
		<step no="8.7.7_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step8.7.4.0_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta3.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) wifi0.1 ${sta3.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(i) eth0 ${sta3.tif.ip}-&gt;${ap3.mgt0.ip}" -i "icmp-echo-req"</log-match>
			<log-match>-n -i "(o) eth0 ${ap3.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-n -i "(i) wifi0.1 ${ap3.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
			<log-match>-i "(o) wifi0.2 ${ap3.mgt0.ip}-&gt;${sta3.tif.ip}" -i "icmp-echo-reply"</log-match>
		</step>

		<step no="9.1.1">
			<desc>
				clear log all on mp2
			</desc>
			<console target="ap2">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="9.1.2">
			<desc>
				clear log all on Portal1
			</desc>
			<console target="ap3">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="9.1.3">
			<desc>
				clear log all on mp1
			</desc>
			<console target="ap1">
				-v "show station"
				-v "clear log all"
			</console>
		</step>

		<step no="9.2">
			<desc>
				sta3 send broadcast packet
			</desc>
			<log-file>step9.2_sta3_send_broadcast.log</log-file>
			<ssh target="sta3">
				-v "ping ${tb.vlan1.broadcast} -b -c 5"
			</ssh>
			<no-error-check />
			<log-match>-c -i "from ${ap3.mgt0.gw}: " -i "ttl="</log-match>
		</step>

		<include prefix="9.2.1" file="subs/save_ap_log.xml" args="show logging buffered, ap3, step9.2.1_show_logging_buffered.log" />

		<step no="9.2.2">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step9.2.2_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta3.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta3.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "interface down, don't flood on eth0"</log-match>
		</step>
		
		<step no="9.2.2_0">
			<desc>
				-show logging buffered in mp2
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step9.2.2_show_logging_mp2.log</log-file>
			<console target="ap2" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta3.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "interface down, don't flood on eth0"</log-match>
		</step>

		<step no="9.2.3">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step9.2.3_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi1.1 ${sta3.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta3.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "interface down, don't flood on eth0"</log-match>
		</step>
		
		<step no="9.2.3_0">
			<desc>
				-show logging buffered in mp1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step9.2.3_show_logging_mp1.log</log-file>
			<console target="ap1" timeout="240">
				-v "show logging buffered"
			</console>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta3.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "interface down, don't flood on eth0"</log-match>
		</step>

		<step no="9.2.4">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" != "true" &amp;&amp; "${ap.is_br}" != "true" </if>
			<log-file>step9.2.1_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.1 ${sta3.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi1.1 ${sta3.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) eth0 ${sta3.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
		</step>
		
		<step no="9.2.4_0">
			<desc>
				-show logging buffered in Portal1
			</desc>
			<if> "${ap.is_aptbbr}" == "true" || "${ap.is_br}" == "true" </if>
			<log-file>step9.2.1_show_logging_buffered.log</log-file>
			<no-error-check />
			<log-match>-i "(i) wifi0.2 ${sta3.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) wifi0.1 ${sta3.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
			<log-match>-i "(o) eth0 ${sta3.tif.ip}-&gt;${tb.vlan1.broadcast}" -i "icmp-echo-req"</log-match>
		</step>
	</stage>
</testcase>
